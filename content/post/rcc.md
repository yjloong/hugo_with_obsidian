---
draft: True
date: 2025-07-04 22:53:02+08:00
title: 使用rcc工具制作完整离线python环境
comment: false
author: yjloong
omit_header_text: true
featured_image: /images/bg01.JPG
toc: false
reward: false
lastmod: 2025-07-05
categories: ["nocategory"]
tags: ['python', 'RCC']
---
# Overview
1. RCC支持构建完整离线python环境，包括python可执行文件本身，以及多个渠道的python包等。
2. 相较于poetry等，RCC更适合于CI/CD场景，RCC会生成一个完整的离线python环境。
3. 官方介绍：Repeatable, movable and isolated Python environments for your automation.
4. RCC原本是robocorp公司用来构建rpa robot的工具，robot运行环境的稳定以及不确定性就诞生了RCC工具。

# Download
[robocorp/rcc: Repeatable, movable and isolated Python environments for your automation. 🚀](https://github.com/robocorp/rcc?tab=readme-ov-file#installing-rcc-from-the-command-line)
```bash
#Windows:
curl -o rcc.exe https://cdn.sema4.ai/rcc/releases/latest/windows64/rcc.exe

#Linux:
curl -o rcc https://cdn.sema4.ai/rcc/releases/latest/linux64/rcc
```

必须挂梯子，否则curl回来的是：
```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<TITLE>ERROR: The request could not be satisfied</TITLE>
</HEAD><BODY>
<H1>403 ERROR</H1>
<H2>The request could not be satisfied.</H2>
<HR noshade size="1px">
The Amazon CloudFront distribution is configured to block access from your country.
We can't connect to the server for this app or website at this time. There might be too much traffic or a configuration error. Try again later, or contact the app or website owner.
<BR clear="all">
If you provide content to customers through CloudFront, you can find steps to troubleshoot and help prevent this error by reviewing the CloudFront documentation.
<BR clear="all">
<HR noshade size="1px">
<PRE>
Generated by cloudfront (CloudFront)
Request ID: nSwN9A-QrZt_YaWZh5P6-1jfzZWDvBlVJw4V15OYZ-Gz_yEwSbG8cA==
</PRE>
<ADDRESS>
</ADDRESS>
```

# Usage

```bash
~/template/test2$ chmod +x rcc
~/template/test2$ ./rcc create

? Give robot name [my-first-robot]: test

Templates:
Warning: Problem updating templates.zip, reason: Failure loading "https://downloads.robocorp.com/templates/templates.yaml", reason: Get "https://downloads.robocorp.com/templates/templates.yaml": EOF
1: Python - Assistant AI Chat
2: Python - Browser automation with Playwright
3: Python - Minimal
4: Python - Producer-Consumer

? Choose a template [1]: 3

The Python - Minimal robot has been created to: test

Get started with following commands:

$ cd test
$ rcc run
# or with name in case of multiple tasks in one robot
$ rcc run --task "<name of tasks>"

```
模板创建完后，布局如下：
```bash
.
├── conda.yaml   # python环境以及所需包配置
├── LICENSE
├── README.md
├── robot.yaml   # rcc自带配置，勿动。
└── tasks.py     # rcc自带回调脚本

0 directories, 5 files
```
## conda.yaml 文件改动
```yaml
# For more details on the format and content:
# https://github.com/robocorp/rcc/blob/master/docs/recipes.md#what-is-in-condayaml
# Tip: Adding a link to the release notes of the packages helps maintenance and security.

channels:
- conda-forge

dependencies:
- python=3.12.8                 # https://pyreadiness.org/3.10
- pip=24.3.1                    # https://pip.pypa.io/en/stable/news
- pip:
- rpaframework==30.0.1        # https://rpaframework.org/releasenotes.html
- robocorp==2.1.3             # https://pypi.org/project/robocorp
- robocorp-browser==2.3.4     # https://pypi.org/project/robocorp-browser
```
-->
```yaml
# For more details on the format and content:
# https://github.com/robocorp/rcc/blob/master/docs/recipes.md#what-is-in-condayaml
# Tip: Adding a link to the release notes of the packages helps maintenance and security.

channels:
- conda-forge

dependencies:
- python=3.12.8                 # https://pyreadiness.org/3.10
- pip=24.3.1                    # https://pip.pypa.io/en/stable/news
- pip:
- websockets # Write What packages you want in pypi.
- requests
```

## robot.yaml 文件改动
```yaml
# For more details on the format and content:
# https://github.com/robocorp/rcc/blob/master/docs/recipes.md#what-is-in-robotyaml

tasks:
Run Task:
shell: python -m robocorp.tasks run tasks.py

environmentConfigs:
- environment_windows_amd64_freeze.yaml
- environment_linux_amd64_freeze.yaml
- environment_darwin_amd64_freeze.yaml
- conda.yaml

artifactsDir: output

PATH:
- .
PYTHONPATH:
- .
ignoreFiles:
- .gitignore

```

-->

```yaml
# For more details on the format and content:
# https://github.com/robocorp/rcc/blob/master/docs/recipes.md#what-is-in-robotyaml

tasks:
Run Task:
shell: pwd

environmentConfigs:
- environment_windows_amd64_freeze.yaml
- environment_linux_amd64_freeze.yaml
- environment_darwin_amd64_freeze.yaml
- conda.yaml

artifactsDir: output

PATH:
- .
PYTHONPATH:
- .
ignoreFiles:
- .gitignore

```

改完文件后，执行命令:
```bash
~/template/test2$ rcc run
"/home/well/template/test2/robot.yaml" as robot.yaml is:
# For more details on the format and content:
# https://github.com/robocorp/rcc/blob/master/docs/recipes.md#what-is-in-robotyaml

tasks:
Run Task:
shell: pwd

environmentConfigs:
- environment_windows_amd64_freeze.yaml
- environment_linux_amd64_freeze.yaml
- environment_darwin_amd64_freeze.yaml
- conda.yaml

artifactsDir: output

PATH:
- .
PYTHONPATH:
- .
ignoreFiles:
- .gitignore

Note! For now, resolved effective environment configuration file is "/home/bajeer/template/test2/conda.yaml".
####  Progress: 00/15  v17.18.0     0.171s  Context: "" <bajeer@well> [linux_amd64/Distributor ID: Ubuntu; Description: Ubuntu 22.04.1 LTS; Release: 22.04; Codename: jammy].
####  Progress: 01/15  v17.18.0     0.007s  Fresh [private mode] holotree environment 7275569d-3626-68cb-6d41-486703cd8900. (parent/pid: 693642/898254)
Warning: Holotree blueprint "e072a951d4e4d5fa" is not publicly cacheable. Use `rcc robot diagnostics` to find out more.
####  Progress: 02/15  v17.18.0     0.002s  Holotree blueprint is "e072a951d4e4d5fa" [linux_amd64 with 96 workers on 256 CPUs from "conda.yaml"].
FINAL unified conda environment descriptor:
---
channels:
- conda-forge
dependencies:
- python=3.12.8
- uv=0.6.11
- pip:
- websockets
- requests
---
####  Progress: 03/15  v17.18.0     0.003s  Fill hololib from RCC_REMOTE_ORIGIN skipped. RCC_REMOTE_ORIGIN was not defined.
####  Progress: 04/15  v17.18.0     0.002s  Cleanup holotree stage for fresh install.
####  Progress: 05/15  v17.18.0     0.002s  Build environment into holotree stage "/home/bajeer/.robocorp/holotree/h64d75db_493f813dad24d3t".
####  Progress: 06/15  v17.18.0     0.002s  Restore partial environment into holotree stage "/home/bajeer/.robocorp/holotree/h64d75db_493f813dad24d3t".
####  Progress: 07/15  v17.18.0     1.484s  Skipping micromamba phase, layer exists.
####  Progress: 08/15  v17.18.0     0.662s  Running pip install phase. (pip v25.1.1) [layer: e072a951d4e4d5fa]
####  Progress: 09/15  v17.18.0     7.081s  Post install scripts phase skipped -- no scripts.
####  Progress: 10/15  v17.18.0     0.008s  Activate environment started phase.
####  Progress: 11/15  v17.18.0     0.988s  Pip check skipped.
####  Progress: 12/15  v17.18.0     0.008s  Update installation plan.
####  Progress: 13/15  v17.18.0     0.002s  Record holotree stage to hololib [with 96 workers on 256 CPUs].
####  Progress: 14/15  v17.18.0     1.295s  Restore space from library [with 96 workers on 256 CPUs].
Installation plan is: /home/bajeer/.robocorp/holotree/64d75db_5a1fac3_9fcd2534/rcc_plan.log
Environment configuration descriptor is: /home/bajeer/.robocorp/holotree/64d75db_5a1fac3_9fcd2534/identity.yaml
####  Progress: 15/15  v17.18.0     1.471s  Fresh holotree done [with 96 workers on 256 CPUs].
Wanted  Version  Origin  |  No.  |  Available           Version    Origin       |  Status
------  -------  ------  +  ---  +  ---------           -------    ------       +  ------
-       -        -       |    1  |  _libgcc_mutex       0.1        conda-forge  |  N/A
-       -        -       |    2  |  _openmp_mutex       4.5        conda-forge  |  N/A
-       -        -       |    3  |  bzip2               1.0.8      conda-forge  |  N/A
-       -        -       |    4  |  ca-certificates     2025.6.15  conda-forge  |  N/A
-       -        -       |    5  |  certifi             2025.6.15  pypi         |  N/A
-       -        -       |    6  |  charset-normalizer  3.4.2      pypi         |  N/A
-       -        -       |    7  |  idna                3.10       pypi         |  N/A
-       -        -       |    8  |  ld_impl_linux-64    2.43       conda-forge  |  N/A
-       -        -       |    9  |  libexpat            2.7.0      conda-forge  |  N/A
-       -        -       |   10  |  libffi              3.4.6      conda-forge  |  N/A
-       -        -       |   11  |  libgcc              15.1.0     conda-forge  |  N/A
-       -        -       |   12  |  libgcc-ng           15.1.0     conda-forge  |  N/A
-       -        -       |   13  |  libgomp             15.1.0     conda-forge  |  N/A
-       -        -       |   14  |  liblzma             5.8.1      conda-forge  |  N/A
-       -        -       |   15  |  libnsl              2.0.1      conda-forge  |  N/A
-       -        -       |   16  |  libsqlite           3.50.1     conda-forge  |  N/A
-       -        -       |   17  |  libstdcxx           15.1.0     conda-forge  |  N/A
-       -        -       |   18  |  libuuid             2.38.1     conda-forge  |  N/A
-       -        -       |   19  |  libxcrypt           4.4.36     conda-forge  |  N/A
-       -        -       |   20  |  libzlib             1.3.1      conda-forge  |  N/A
-       -        -       |   21  |  ncurses             6.5        conda-forge  |  N/A
-       -        -       |   22  |  openssl             3.5.0      conda-forge  |  N/A
-       -        -       |   23  |  pip                 25.1.1     conda-forge  |  N/A
-       -        -       |   24  |  python              3.12.8     conda-forge  |  N/A
-       -        -       |   25  |  readline            8.2        conda-forge  |  N/A
-       -        -       |   26  |  requests            2.32.4     pypi         |  N/A
-       -        -       |   27  |  setuptools          80.9.0     conda-forge  |  N/A
-       -        -       |   28  |  tk                  8.6.13     conda-forge  |  N/A
-       -        -       |   29  |  tzdata              2025b      conda-forge  |  N/A
-       -        -       |   30  |  urllib3             2.5.0      pypi         |  N/A
-       -        -       |   31  |  uv                  0.6.11     conda-forge  |  N/A
-       -        -       |   32  |  websockets          15.0.1     pypi         |  N/A
-       -        -       |   33  |  wheel               0.45.1     conda-forge  |  N/A
------  -------  ------  +  ---  +  ---------           -------    ------       +  ------
Wanted  Version  Origin  |  No.  |  Available           Version    Origin       |  Status

--
/home/bajeer/template/test2
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@  From rcc "v17.18.0" point of view, "actual main robot run" was SUCCESS. @@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
|  "Build/Pre-run"  relative time allocation ratio:  1:0
|  "Setup/Run"  relative time allocation ratio:  131:2
OK.
```
- 到这里，隔离环境包的基本功能就可以使用了。
- 上述生成的python位置在：Environment configuration descriptor is: /home/bajeer/.robocorp/holotree/64d75db_5a1fac3_9fcd2534/bin/python。
- 可以将/home/bajeer/.robocorp/holotree/64d75db_5a1fac3_9fcd2534/打包到其他任何位置运行。
- 但在某些条件下，python对路径/home/bajeer/.robocorp/holotree/64d75db_5a1fac3_9fcd2534/有依赖，如cython寻找模块头文件等。这时可以使用如下脚本代替rcc run执行：
```bash
# env_update.sh
#!/bin/bash -e
env_dir=$(readlink -f env)
rm -rf $env_dir
rcc run |& tee /tmp/rcc.log

holotree=$(grep "Environment configuration descriptor is" /tmp/rcc.log | cut -d: -f2)
holotree=${holotree%/*}
holotree=$(echo ${holotree})
cp -r ${holotree} ${env_dir}

find $env_dir -type f -name "*.py" -exec sed -i "s#${holotree}#${env_dir}#g" {} +
```
- 上述脚本需要按场景自行修改。
